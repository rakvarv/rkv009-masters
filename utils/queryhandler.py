import openai
import json
import os, sys
from config import Config
from openai import OpenAI

# A base class for sending queries to the OpenAI API
class Query:
    # Initializing the class with the model and API key
    def __init__(self):
        self.model = Config.OPENAI_MODEL
        self.api_key = Config.SECRET_KEY

    # Method for sending a query
    # This method is not implemented in this base class and must be implemented in any subclasses
    def send_query(self, prompt: str):
        raise NotImplementedError("Subclasses must implement this method.")
    
# Define a subclass for sending chat completion queries that return JSON responses
class ChatCompletionJSON(Query):
    # Initialize the class with the number of tokens
    def __init__(self, tokens: int):
        super().__init__()
        self.tokens = tokens 
        
    def send_query(self, prompt: str):

        #openai.api_key = self.api_key
        openai.api_key = Config.SECRET_KEY
        client = OpenAI(api_key=Config.SECRET_KEY)
        response = client.chat.completions.create(
            model = "gpt-4-turbo",
            messages=[
                {"role": "system", "content": "You are trained to extract named graphical locations and the geographical relationships between them. The only locations that will be picked out are permanent named, and locally/globally recognized as a permanent location in that geographical area. Once a news-text/text is fed to you, you need to extract the relationships and locations in a specific format, which is JSON String. The JSON String format looks like this {‘locations’: [{‘name’: ‘locationName’, ‘type’: ‘Location’, ‘entity’: ‘locationType’}], ‘relationships’: [‘from’: ‘fromLocation’, ‘relation’: ‘relationBetweenLocations’, ‘target’: ‘targetLocation’]}. You must keep this format, and the JSON keys provided must have the same keyname as these ones just provided. Different locations have different types, and different types of locations have different relationships it can inherit. An example is that a body of water that is bordering a landmass is not a part of that landmass, but just bordering it, unless the landmass encapsulates it. You must follow a specific ontology, which describes these. This is the ontology. The different types of locations you have available in the entity key is: [Land, Ocean, Road, Mountain]. Land is categorized as permanent named geographical locations on land. Land can include forests, bodies of water, cities, and so on. Examples of locations of this entity is: [Vestland, Bergen, Åsane, Vik, Loddefjord]. The relationships belonging to Land is: [isNearby, contains, isAdjecentTo]. Roads is another entity type, examples of roads are: [highways, freeways, motorways, roads]. A road can not be a mountain trail in this instance. All relations linked to a road is: [isNearby, isPassingThrough, isAdjecentTo] Third entity class, which is Ocean. Ocean is a named large body of water. An ocean can also encapsulate islands. Relations belonging to oceans are: [contains, isNearby, isAdjecentTo]. Last location entity is Mountain. Mountains are recognized as tall landmass tops, which are named. Examples of mountains are: [Filefjell, Hemsedalsfjellet, Lyderhorn, Ulriken]. Relations linked to mountains are: [isNearby, overlooks]. All location entity types can have the relationships: [isNearby, isAdjecentTo]. All location specific relations are relations that can only be used from that location entity type, which is really important to follow. Relationship keys must be [from, relation, target]. All locations extracted must be found in the news text provided, and that only the relationships provided can be used, and this must be followed. And this format: {‘locations’: [{‘name’: ‘locationName’, ‘type’: ‘Location’, ‘entity’: ‘locationType’}], ‘relationships’: [‘from’: ‘fromLocation’, ‘relation’: ‘relationBetweenLocations’, ‘target’: ‘targetLocation’]} must be followed."},
                {"role": "user", "content": "Text: Norge har en rekke rasfarlige veistrekninger. Nederst i saken har vi listet ut de ti verste riksveiene og de ti verste fylkesveiene. Og det kan bli svært dyrt å utbedre disse veiene. Ifølge beregninger NAF har gjort, vil det nemlig koste til sammen 14,2 milliarder kroner, bare å sikre de ti mest rasfarlige strekningene på riks og fylkesveinettet. Det haster å sette i gang skredsikring av flere strekninger, sier pressesjef PERSON i NAF. Summen fordeler seg på 8,7 milliarder kroner på riksveier og 5,5 milliarder kroner på fylkesveier, ifølge oversikten. Den tar utgangspunkt i tall fra Statens vegvesens oversikt over skredpunkt som er levert inn til Samferdselsdepartementet i forbindelse med ny Nasjonal transportplan. Mange av de mest skredfarlige strekningene er i Vestland fylke, spesielt på riksveiene. Dette er veier der faren for ras er høy og hvor en hendelse kan få store konsekvenser, sier Handagard. Hvis alle skredpunkt med høy og middels faregrad skulle sikres, ville det koste totalt 95 milliarder kroner, opplyser NAF. Behovene er store også i Nordland, Troms, Finnmark og Møre og Romsdal. Skredfaktor beregnes ut fra hvor sannsynlig det er at det går ras. Man ser på hvilke konsekvenser det kan få ut fra hvor mye trafikk det er på stedet, mulighet for omkjøring og andre faktorer.  Dette er bare toppen av isfjellet. På riksveiene er det 78 steder med høy skredfaktor, og på fylkesveiene er tallet 123. I tillegg kommer en rekke steder med middels eller lav faregrad, der det fortsatt er behov for tiltak, sier PERSON. På mange utsatte strekninger er det behov for tunnel eller ny trasé for å sikre veien. I tillegg til de store investeringene som trengs på noen av de mest rasfarlige strekningene, er det mye som kan gjøres med mindre tiltak. Varsling, sikring av terrenget og andre utbedringer kan gjennomføres relativt raskt, om midlene kommer på plass, sier PERSON. Riksveier rangert etter skredfaktor: Rv 13 Kvassdalen Vestland, Rv13 Osgjelet Vestland, Rv 5 Skredvikja Vestland, E16 Vaksdal Vestland, Rv 13 Byrkjenes Vestland, Rv 15 Grasdalen Vestland, E 10 Presteneset Nordland, E10 Kvanndalen Nordland, Rv 13 Øvre Lonevatn Vestland, Rv 13 Ygningsdalshamrane Vestland, Fylkesveier rangert etter skredfaktor: Fv 5744 Navelsakerstranda Vestland, Fv 5829 Otterdalsstranda Møre og Romsdal, Fv 613 Gaularfjellet Vestland, Fv 5723 Merkingsgjølet Vestland, Fv 7594 Myrlandsfjellet Nordland, Fv 5625 Skjerdalsberget Vestland, Fv 8830 Store Lerresfjord Finnmark, Fv 5724 Heimefonna Vestland, Fv 49 Snauhaugtunnelen Vestland, Fv 49 Tokagjeltunnelen Vestland"},
                {"role": "assistant", "content": "{'locations': [{'name': 'Norge', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vestland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordsland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Troms', 'type': 'Location', 'entity': 'Land'}, {'name': 'MøreOgRomsdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Kvassdalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Osgjelet', 'type': 'Location', 'entity': 'Land'}, {'name': 'Skredvikja', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vaksdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Byrkjenes', 'type': 'Location', 'entity': 'Land'}, {'name': 'Grasdalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Presteneset', 'type': 'Location', 'entity': 'Land'}, {'name': 'Kvanndalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'ØvreLonevatn', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Ygningsdalshamrane', 'type': 'Location', 'entity': 'Land'}, {'name': 'Navelsakerstranda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Otterdalsstranda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Gaularfjellet', 'type': 'Location', 'entity': 'Mountain'}, {'name': 'Merkingsgjølet', 'type': 'Location', 'entity': 'Land'}, {'name': 'Myrlandsfjellet', 'type': 'Location', 'entity': 'Mountain'}, {'name': 'Skjerdalsberget', 'type': 'Location', 'entity': 'Land'}, {'name': 'StoreLerresfjord', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Heimefonna', 'type': 'Location', 'entity': 'Land'}, {'name': 'Snauhaugtunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Tokagjeltunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Finnmark', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Norge', 'relation': 'contains', 'target': 'Vestland'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Nordsland'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Troms'}, {'from': 'Norge', 'relation': 'contains', 'target': 'MøreOgRomsdal'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Kvassdalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Osgjelet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Skredvikja'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Vaksdal'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Byrkjenes'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Grasdalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Presteneset'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Kvanndalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'ØvreLonevatn'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Ygningsdalshamrane'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Navelsakerstranda'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Otterdalsstranda'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Gaularfjellet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Merkingsgjølet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Myrlandsfjellet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Skjerdalsberget'}, {'from': 'Norge', 'relation': 'contains', 'target': 'StoreLerresfjord'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Heimefonna'}, {'from': 'Snauhaugtunnelen', 'relation': 'isPassingThrough', 'target': 'Norge'}, {'from': 'Tokagjeltunnelen', 'relation': 'isPassingThrough', 'target': 'Norge'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Finnmark'}]}"},
                {"role": "user", "content": "En personbil kolliderte med stor kraft med en tankbil i en tunnel mellom Voss og Bergen. Tankbilen fraktet etsende væske.  I tunnelen bak oss har det skjedd en alvorlig ulykke mellom en trailer og en personbil. Det er en møteulykke og det er store skader på både personbil og trailer, sier innsatsleder PERSON i Vest politidistrikt. Ulykken skjedde litt etter klokken 18, i Stavenestunnelen på E16 i Vaksdal i Vestland. Det var kun én person i hvert kjøretøy. Lastebilen var på vei til Bergen og personbilen på vei mot Voss. Det er én person som er omkommet. Lastebilsjåføren har vi fått ut av tunnelen. Han er lettere skadet og brakt til Bergen til legeundersøkelse. Avdødes pårørende er varslet, opplyser PERSON. Tankbilen lekker etsende væske. Det gjør nødetatenes redningsarbeid vanskeligere.Det er en vanskelig og uavklart situasjon der inne, med denne væsken og at det teoretisk kan begynne å brenne. Vi har etablert brannberedskap der inne, i tilfelle det skulle skje noe med disse to kjøretøyene, sier PERSON. Politiet har fått vite at det er snakk om et rensestoff som brukes i vann. Det er ikke en eksplosjonsfarlig væske. Det er i utgangspunktet ikke farlig, sier Listøl, som forklarer at den kun er skadelig hvis man får den på huden, inntar den eller hvis den begynner å brenne. Stengt i lang tid. Arbeidet på åstedet kompliseres også av at tankbilen som lekker, står kilt fast inne i tunnelen. Vi planlegger nå hvordan vi skal få stoppet lekkasjen, hvordan vi skal komme oss inn i tunnelen for å gjennomføre åstedsundersøkelser med Statens ulykkesgruppe og politiets kriminalteknikere. Tunnelen er ellers helt tømt. E16 er stengt og vil være stengt i lang tid fremover. Iallfall gjennom natten og langt utpå tirsdagen, sier PERSON. Det har vært en konstant lekkasje ut i veibanen. Denne tanken på vogntoget ligger veltet inn mot fjellveggen, i klem. Nå får vi høre at lekkasjen har avtatt noe. Krimteknikere på vei. Like før klokken 20 opplyste politiet at ulykkesgruppen samt politiets kriminalteknikere var på vei til stedet. Nødetatene planlegger nå for å få stengt lekkasjen, av det som blir betegnet som en svakt etsende væske som er ufarlig, opplyser politiet. Vegtrafikksentralen vest opplyser at omkjøring er via Hardanger Fylkesvei 49 og Fylkesvei 79."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Voss', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vaksdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vestland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Hardanger', 'type': 'Location', 'entity': 'Land'}], 'relationships': []}"},
                {"role": "user", "content": "Flere store ras har gått i Vestland mandag. E16 er stengt i Nærøydalen, mens på Voss er flere hytter truffet av ras. Flere hytter er truffet av jord og steinmasser ved Voss Resort på Tråstølen. En video TV 2 har fått tilsendt, viser hvordan massene har tatt seg ned gjennom hyttefeltet og hvordan det går tett inntil flere hytter. Til TV 2 sier operasjonsleder PERSON i politiet at de har gjort seg ferdige på stedet og at det ikke er meldt om noen skader på personer eller bygninger. Det er mye vann i området og har trukket med seg jord og stein. Veien oppe i hytteområdet er ødelagt enkelte steder. Videre sier han at de har vært i dialog med Voss Resort, som har gravd nye grøfter for å lede vannet andre steder. Politet har også vært i kontakt med beredskapsavdelingen i kommunen. Det er foretatt noen vurderinger, men ingen er bedt om å forlate hyttene. Flere ras over E16. På E16s strekning mellom Voss og Lærdal er veien er stengt flere steder som følge av steinras og styrtregn. Blant annet holdes Gudvangatunnelen i Aurland og Sivletunnelen i Voss stengt inntil videre på grunn av rasene. Til TV 2 bekrefter brannvesenet i Vest at to hus er evakuert i Nærøydalen. Her har også brannvesenet hatt en drone i lufta, men ikke oppdaget at noe eller noen er tatt av raset. Operasjonsleder PERSON sier til TV 2 at de har patruljer på stedet ved 19.40tiden, og at de har undersøkt raset så godt det lar seg gjøre før opprydningsarbeidet starter. Vi kan ikke helt med sikkerhet si at det befinner seg noe i raset, men vi har ingen indikasjoner på at det skal være tilfellet. Noen arbeidere i området har også ifølge polititet tatt inn på hotell i Gudvangen. Ifølge brannvesenet er det ved 18tiden ikke mulig å si hvor lenge veien vil være sperret.  Det er et svært ras, og det vil trolig ta lang tid å åpne opp igjen, sier vaktkommandør i brannvesenet til TV 2. Stengt flere steder. ølge brannvesenet er raset rundt tre meter høyt på det høyeste. Mens til VG sier politiet at raset skal være fem meter høyt på det høyeste. Det var ved 16.40tiden at brannvesenet meldte om at de hatt fått meldinger om flere ras over veien her. Det er stort ras som sperrer hele veien. Det er alt vi vet, men nødetatene er på vei. Gudvangatunnelen og Sivletunnelen holdes stengt til vi får oversikt, sa trafikkoperatør PERSON i Statens vegvesen da til Bergensavisen. Ifølge NRK er også Stalheimtunnelen i Voss stengt etter steinraset i Nærøydalen. Farevarsel. Flere steder på Vestlandet er mandag rammet av store nedbørsmengder. Det er sendt ut gult farevarsel (nivå to av fire) for store deler av landsdelen. Fra Nordfjord i Stad i nord til Mandal i sør er det gult farevarsel for styrtregn, ifølge Varsom. Verst vil det trolig være fra Sauda i sør til litt nord for Bergen. Nettstedet skriver at det er fare for overvann i tettbygde områder, lokale oversvømmelser, bekke og elveløpsendringer, jord og flomskred der regnbygene treffer. De advarer også om at det er fare for stengte veier og/eller overvann ved bekke og elveløp samt lokalt vanskelige kjøreforhold grunnet overvann og fare for vannplaning. Turister skal være innesperret. Politiet sier at de har hatt flere hendelser knyttet til været mandag. Men det har roet seg nå de siste par timene, sier operasjonsleder PERSON ved 19.40tiden. Det siste er at det har gått nok et ras nede ved fergekaien i Gudvangen, men ingen skader der heller. Det er mulig at noen turister er innesperret der. Det er rekvirert en båt for å få dem ut på rett side av raset, sier operasjonslederen. Bil truffet av stein. Avisa Hordaland melder at en bil på fylkesvei 79 i Granvin i Voss ble truffet av steinsprang. En kvinne som var passasjer i bilen, ble truffet av steinen etter at den gikk gjennom frontruten, opplyser politiet. Kvinnen, som var en fransk turist, er sendt til sykehus på Voss, ifølge avisen. Skadeomfanget er ukjent, men kvinnen skal ha være bevisst da hun ble ivaretatt av helsepersonell på stedet."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Nærøydalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Voss', 'type': 'Location', 'entity': 'Land'}, {'name': 'Tråstølen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Aurland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Gudvangen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sivletunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Stalheimtunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Nordfjord', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Stad', 'type': 'Location', 'entity': 'Land'}, {'name': 'Mandal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sauda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Granvin', 'type': 'Location', 'entity': 'Land'}, {'name': 'Hordaland', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Voss', 'relation': 'contains', 'target': 'Tråstølen'}, {'from': 'Voss', 'relation': 'isNearby', 'target': 'Lærdalen'}, {'from': 'Gudvangtunnelen', 'relation': 'isPassingThrough', 'target': 'Aurland'}, {'from': 'Sivletunnelen', 'relation': 'isPassingThrough', 'target': 'Voss'}, {'from': 'Stalheimtunnelen', 'relation': 'isPassingThrough', 'target': 'Voss'}, {'from': 'Voss', 'relation': 'contains', 'target': 'Nærøydalen'}, {'from': 'Stad', 'relation': 'contains', 'target': 'Nordfjord'}, {'from': 'Sauda', 'relation': 'isNearby', 'target': 'Bergen'}]}"},
                {"role": "user", "content": "Det seier politisjef i Sogn og Fjordane, Arne Johannessen. Politiet har no kome med sin uttale til den planlagde oppgraderinga av Lærdalstunnelen, som vil bety full eller delvis stenging. Johannessen og politiet er krystallklare på at dette har følgjer for vaktsystema,  beredskapen og kostnadene ved dette. Full stenging er veldig krevjande for oss, og ut ifrå eit beredskapsmessig perspektiv er dette eit svært dårleg alternativ. Me har også problematisert det andre alternativet med delvis stenging, og meiner det må inn kompenserande tiltak, seier PERSON."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Lærdalstunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Lærdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'SognOgFjordane', 'type': 'Location', 'entity': 'Road'}], 'relationships': [{'from': 'Lærdalstunnelen', 'relation': 'isPassingThrough', 'target': 'SognOgFjordane'}]}"},
                {"role": "user", "content": "Davidsen ble gjenvalgt med stående applaus på Pensjonistforbundets landsmøte onsdag. Jeg takker for tilliten og er ydmyk, sa han. Dermed går PERSON løs på sin tredje periode som forbundsleder i landets desidert største organisasjon for alderspensjonister og uføre. I tillegg til PERSON består Pensjonistforbundets nye sentralstyre frem til 2026 av; 1. nestleder: PERSON (Sogn og Fjordane) 2. nestleder: PERSON (Agder) Styremedlem: PERSON (Akershus) Styremedlem: PERSON (Troms) Styremedlem: PERSON (Oppland) Styremedlem: PERSON (Trøndelag) 1. varamedlem: PERSON, Oslo 2. varamedlem: PERSON, PERSON 3. varamedlem: PERSON, Nordland 4. varamedlem: PERSON, Vestfold I tillegg har Fagforbundet to medlemmer i sentralstyret PERSON og PERSON."},
                {"role": "assistant", "content": "{'locations': [{'name': 'SognOgFjordane', 'type': 'Location', 'entity': 'Land'}, {'name': 'Agder', 'type': 'Location', 'entity': 'Land'}, {'name': 'Akershus', 'type': 'Location', 'entity': 'Land'}, {'name': 'Troms', 'type': 'Location', 'entity': 'Land'}, {'name': 'Oppland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Trøndelag', 'type': 'Location', 'entity': 'Land'}, {'name': 'Oslo', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vesthold', 'type': 'Location', 'entity': 'Land'}], 'relationships': []}"},
                {"role": "user", "content": "No trur eg kanskje me endar med å køyra endå lenger. Det er vegarbeid, seier en person på bussen heim frå Os. Heldigvis med siger og cupavansement i bagasjen. Det er sikkert. Me fekk veldig mange borteturar på kort tid no, men eg trur ikkje dette påverkar oss så veldig. Me er godt vande med å køyra buss. Me kunne ikkje brukt det som ei bortforklaring. Alle har to seter kvar og me får sett mykje film, seier en annen person. Det hadde vorte hylekor Det er en tredje person som har rekna ut avstanden Sogndal har køyrt i buss til og frå dei siste fire kampane. Eg skulle likt å høyra eitt av austlandslaga om dei hadde måtta leggja ut på ein tilsvarande distanse på 12 dagar. Det hadde vorte eit hylekor, seier vedkommende og ristar på hovudet. Sogndal starta med følgjande lag i Os: Sætren – Hoven, Arrocha, Gueye, Sjølstad – Steinset, Twum, Nessø – Kupen, Diaz, Ørjasæter. 120 lange minuttar Og det reisetrøytte Sogndallaget sitt siste stopp mot 3. divisjonslaget Lysekloster, i Os på andre sida av Bergen, vart av det slitsame slaget. Det sat langt inne å sikra seg avansement til 3. runde i cupen. Kristoffer Nessø sende Sogndal i føringa allereie etter to minutt, men då Lysekloster utlikna tre minutt seinare var dei like langt. Og dei kom ikkje lenger før det var spelt 110 minutt med fotball i finvêret på Os. Først ut i andre ekstraomgang greidde innbytar Jonatan Jonsson å avgjera, med ein meisterleg enkeltmannsprestasjon. Han sprang frå midten av motstandarane sin halvdel, og fyrte av ein kanon i nettet. Det var ikkje plankekøyring etter det heller. Isaac Twum fekk sitt andre gule nett etter, og fekk avslutta kampen litt før dei andre. Men Sogndal rodde det i land. Ikkje lyst Eg hadde ikkje lyst på ekstraomgangar. Men det måtte me ha. Så det vart ein lang kamp. Men det gjer det lettare når me vinn til slutt. Vedkommende vedgår at sigeren sat veldig langt inne. Det var tøft til siste sekund. Lysekloster gav oss skikkeleg kamp. Me fekk ingenting gratis. Dei var kjappe til å koma seg bak, så me fekk aldri tatt dei på kontringar og slikt som du ofte klarar mot lag som ligg lågare. Så snart dei mista ballen var dei utruleg kjapt organisert, seier en person. Mange rauk ut i kveld Medan Sogndal klarte det, rauk divisjonskollegaene Hødd, Skeid, Kongsvinger og Bryne ut – alle mot det ein må rekna som svakare motstand. Og på toppen av det heile gjekk eliteserielaga Rosenborg, Lillestrøm og Stabæk på kvar si cupbombe mot StjørdalsBlink og Kjelsås. – Alle veit at slike cupkampar er ikkje berre enkelt. Når Lillestrøm og Rosenborg ryk ut i andre runde viser det at det kan bli vanskeleg når motstandarlaget fekk momentum. Me såg det på Lysekloster og. Dei jubla for kvar takling. Det er inga orsaking om me taper, men me vann til slutt. Sonen skåra Vel inne i bussen fekk han også gladmeldinga om at sonen Johan skåra sitt eine mål i tapet mot Brann i same turnering. – Eg trur eg har skåra ein gong sjølv. Det var bra. Det hadde vorte mobbing elles, seier en person som ikkje har hastverk med å avslutta telefonsamtalen. – Takk for praten. Me skal sitja her i mange timar."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Agder', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sogndal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Rosenborg', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Lillestrøm', 'type': 'Location', 'entity': 'Land'}, {'name': 'Stabæk', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Norge', 'relation': 'contains', 'target': 'Bergen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Os'}]}"},
                {"role": "user", "content": "Stadig flere turister fra hele verden tar turen til bergensregionen etter å ha lest om norsk ull og strikkekunst. Smakfulle bilder i sosiale medier er et viktig trekkplaster. Denne helgen samles flere hundre strikkeentusiaster på Osterøy til fire dagers samling. – Strikketurismen i vår region er økende. Vi ser at stadig flere utlendinger besøker regionen vår for å lære om ull og strikk, bekrefter reiselivsdirektør Anders Nyland i Visit Bergen. Den franske strikkedesigneren Julie Dubreaux, som kommer til Osterøy, har 43.100 følgere på Instagram:Britiske strikketurister I september kommer en britisk delegasjon med egen guide på besøk til Nordhordland for andre året på rad. De skal på strikkeferie i åtte dager, bekrefter han. – Det gleder oss å se at markedsføringen av Wool Heritage Route, som vi har gjort sammen med gode partnere, begynner å bære frukter. Treffer man godt i en slik nisje ser vi at dette er gjester med god betalingsevne som blir her i mange dager, sier Nyland.Reiselivsdirektøren er selv en av foredragsholderne under strikketreffet. Han trekker frem lokale produsenter som Norlender, Oleana og Dale of Norway som viktige trekkplastre. Et ullent eventyr Fredag starter det rikholdige strikkeprogrammet i Mjøsvågen på Osterøy. Initiativtakeren heter Anne Bjørke. Hun har invitert en rekke norske og utenlandske designere, deriblant Julie Dubreaux fra Paris og estiske Aleks Byrd til et felles «ulleventyr». – Fredag arrangerer vi bransjeseminar med fokus på norsk ull og ullturisme, som kan gi bønder og småskalabedrifter et ekstra bein å stå på. Vi samarbeider med Norlender i Lonevåg, en av få gjenlevende trikotasjebedrifter som fortsatt produserer strikkeplagg i Norge, forteller hun. Lørdag og søndag blir det avholdt kurs med strikkekjendiser, catwalk på flytebryggen og foredrag. Blant annet skal den ukrainske designeren Iaroslava Rud fortelle om sine blondesjal inspirert fra strikkekunsten på Shetland. – Her håper vi på mange besøkende og har fortsatt ledige billetter! Tilbyr gratis overnatting Anne Bjørke står bak bokprosjektet Strikkekraft, der designdesignerne skal bruke Norlenders maskinstrikkede plagg som en felles inspirasjonskilde og lage 20 nye håndstrikkmønstre. Deltakerne på Osterøysamlingen får smakebiter på norsk tradisjonsstrikk og internasjonal design fra Nigeria og Shetland til Ukraina, Estland og Frankrike. – Målet er å treffe likesinnede og hente inspirasjon. Jeg elsker å reise til andre land og se hva andre lager. Estisk og norsk strikkekunst har mange ulikheter, men også likheter, sier Aleks Byrd til BA. – Folk i bygden stiller opp med sengeplasser til alle designerne, maten blir laget på dugnad og det blir dropin i den flytende kunstbadstuen Flabellina. Den ideelle stiftelsen Vener av Mjøsvågen er en aktiv støttespiller, skryter Anne Bjørke."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Osteræy', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordhordaland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Norway', 'type': 'Location', 'entity': 'Land'}, {'name': 'Paris', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nigeria', 'type': 'Location', 'entity': 'Land'}, {'name': 'Shetland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Ukraina', 'type': 'Location', 'entity': 'Land'}, {'name': 'Estland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Frankrike', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Frankrike', 'relation': 'contains', 'target': 'Paris'}]}"},
                {"role": "user", "content": "Vegtrafikksentralen rapporterte om et trafikkuhell ved Vetlebotnvatnet på Fv. 50 i Aurland fredag kl. 12:34. Nødetatene rykket ut til stedet. Politiet kunngjorde på Twitter at en motorsykkel hadde kjørt av veien ved Stemmedalen, og føreren var ved bevissthet. Kl. 13:15 meldte Vegtrafikksentralen at veien ville bli stengt mens luftambulansen landet på stedet. Rundt halv to opplyste politiet at føreren ville bli fløyet til sykehuset i Førde. 'Føreren er ved bevissthet. Han kan ha pådratt seg mindre skader. Trafikkregulering på stedet, og en bilbergingsenhet er tilkalt,' skrev politiet i meldingen."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Aurland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Førde', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vetlebotnvatnet', 'type': 'Location', 'entity': 'Ocean'}], 'relationships': [{'from': 'Aurland', 'relation': 'contains', 'target': 'Vetlebotnvatnet'}]}"},
                {"role": "user", "content": "Det ble travelt for utrykningspolitiet da de torsdag ettermiddag hadde laserkontroll ved utløpet av Knappetunnelen i Dolvik. Mellom klokken 14 og 17 stoppet UP 28 bilister som kjørte over fartsgrensen i 80sonen. UP fikk mange reaksjoner på høyt fartsnivå. De kunne ha stoppet enda flere bilister, men hadde ikke kapasitet eller mannskap til å stoppe alle, opplyser stasjonssjef Ronny André Øvrebotten ved Bergen sør politistasjon. Det var en mcfører som ble målt til høyest fart torsdag ettermiddag. Mcføreren, en mann i 20årene, kjørte i 152 km/t i 80sonen. Han kjørte så fort at han mistet førerkortet, sier Øvrebotten."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Knappetunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Dolvik', 'type': 'Location', 'entity': 'Land'}], 'relationship': [{'from': 'Knappetunnelen', 'relation': 'isPassingThrough', 'target': 'Dolvik'}]}"},
                {"role": "user", "content": "Rv 5 Kjøsnestunnelen i Sunnfjord er midlertidig stengt på grunn av en stor gjenstand på veien, som antas å ha falt fra en lastebil. Politiet er på vei, som rapportert av Vegtrafikksentralen på Twitter. Det ble også rapportert at Fjærlandstunnelen var stengt på grunn av bilberging. Klokken 14.44 ble det rapportert at bilberging var fullført, og denne tunnelen ble åpnet igjen. Klokken 14.55 ble også Kjøsnestunnelen åpnet igjen."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Kjøsnestunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Sunnfjord', 'type': 'Location', 'entity': 'Land'}, {'name': 'Fjærlandstunnelen', 'type': 'Location', 'entity': 'Road'}], 'relationships': [{'from': 'Kjøsnestunnelen', 'relation': 'isPassingThrough', 'target': 'Sunnfjord'}]}"},
                {"role": "user", "content": f"Now, given the following text, please extract the locations and their geographical relationships and return the output in a valid JSON String output format, and do it to anything that remotely resemble a geo location: Text: {prompt}"}
            ],
            temperature = 0.5,
            max_tokens = Config.MAX_TOKENS
        )
        api_response = response.choices[0].message.content
        print(api_response)

        # Check if the API response is a string
        if isinstance(api_response, str):
            try:
                # Try to parse the string as JSON
                api_response = json.loads(api_response)

                # Extract the locations and relationships from the API response
                #locations = [loc['name'] for loc in api_response['locations']]
                #relationships = [{'source': rel['source'], 'relation': rel['relation'], 'target': rel['target']} for rel in api_response['relationships']]

                if 'locations' in api_response:
                    locations = [loc['name'] for loc in api_response['locations']]
                else:
                    locations = []  # or any appropriate default value

                relationships = []
                for rel in api_response.get('relationships', []):
                    try:
                        relationships.append({
                            'from': rel['from'],
                            'relation': rel['relation'],
                            'target': rel['target']
                        })
                    except KeyError as e:
                        # Handle the missing key: log it, append a placeholder, etc.
                        print(f"Missing key {e} in relationship: {rel}")

                print(locations)
                print(relationships)

                return api_response, locations, relationships
            except json.JSONDecodeError:
                print("The API response is not valid JSON.")
        else:
            print("The API response is already a python Dictionary, no need to parse it.")

# A subclass for sending chat completion queries that return other types of responses
class ChatCompletionGPT20(Query):
    # Initializing the class with the number of tokens
    def __init__(self, tokens: int):
        super().__init__()
        self.tokens = tokens 

    # Implementing the send_query method for this subclass
    def send_query(self, prompt: str):
        openai.api_key = self.api_key
        client = OpenAI()
        response = client.chat.completions.create(
            model = self.model,
            messages=[
                {"role": "system", "content": "You are trained to extract named graphical locations and the geographical relationships between them. The only locations that will be picked out are permanent named, and locally/globally recognized as a permanent location in that geographical area. Once a news-text/text is fed to you, you need to extract the relationships and locations in a specific format, which is JSON String. The JSON String format looks like this {‘locations’: [{‘name’: ‘locationName’, ‘type’: ‘Location’, ‘entity’: ‘locationType’}], ‘relationships’: [‘from’: ‘fromLocation’, ‘relation’: ‘relationBetweenLocations’, ‘target’: ‘targetLocation’]}. You must keep this format, and the JSON keys provided must have the same keyname as these ones just provided. Different locations have different types, and different types of locations have different relationships it can inherit. An example is that a body of water that is bordering a landmass is not a part of that landmass, but just bordering it, unless the landmass encapsulates it. You must follow a specific ontology, which describes these. This is the ontology. The different types of locations you have available in the entity key is: [Land, Ocean, Road, Mountain]. Land is categorized as permanent named geographical locations on land. Land can include forests, bodies of water, cities, and so on. Examples of locations of this entity is: [Vestland, Bergen, Åsane, Vik, Loddefjord]. The relationships belonging to Land is: [isNearby, contains, isAdjecentTo]. Roads is another entity type, examples of roads are: [highways, freeways, motorways, roads]. A road can not be a mountain trail in this instance. All relations linked to a road is: [isNearby, isPassingThrough, isAdjecentTo] Third entity class, which is Ocean. Ocean is a named large body of water. An ocean can also encapsulate islands. Relations belonging to oceans are: [contains, isNearby, isAdjecentTo]. Last location entity is Mountain. Mountains are recognized as tall landmass tops, which are named. Examples of mountains are: [Filefjell, Hemsedalsfjellet, Lyderhorn, Ulriken]. Relations linked to mountains are: [isNearby, overlooks]. All location entity types can have the relationships: [isNearby, isAdjecentTo]. All location specific relations are relations that can only be used from that location entity type, which is really important to follow. Relationship keys must be [from, relation, target]. All locations extracted must be found in the news text provided, and that only the relationships provided can be used, and this must be followed. And this format: {‘locations’: [{‘name’: ‘locationName’, ‘type’: ‘Location’, ‘entity’: ‘locationType’}], ‘relationships’: [‘from’: ‘fromLocation’, ‘relation’: ‘relationBetweenLocations’, ‘target’: ‘targetLocation’]} must be followed."},
                {"role": "user", "content": "Text: Norge har en rekke rasfarlige veistrekninger. Nederst i saken har vi listet ut de ti verste riksveiene og de ti verste fylkesveiene. Og det kan bli svært dyrt å utbedre disse veiene. Ifølge beregninger NAF har gjort, vil det nemlig koste til sammen 14,2 milliarder kroner, bare å sikre de ti mest rasfarlige strekningene på riks og fylkesveinettet. Det haster å sette i gang skredsikring av flere strekninger, sier pressesjef PERSON i NAF. Summen fordeler seg på 8,7 milliarder kroner på riksveier og 5,5 milliarder kroner på fylkesveier, ifølge oversikten. Den tar utgangspunkt i tall fra Statens vegvesens oversikt over skredpunkt som er levert inn til Samferdselsdepartementet i forbindelse med ny Nasjonal transportplan. Mange av de mest skredfarlige strekningene er i Vestland fylke, spesielt på riksveiene. Dette er veier der faren for ras er høy og hvor en hendelse kan få store konsekvenser, sier Handagard. Hvis alle skredpunkt med høy og middels faregrad skulle sikres, ville det koste totalt 95 milliarder kroner, opplyser NAF. Behovene er store også i Nordland, Troms, Finnmark og Møre og Romsdal. Skredfaktor beregnes ut fra hvor sannsynlig det er at det går ras. Man ser på hvilke konsekvenser det kan få ut fra hvor mye trafikk det er på stedet, mulighet for omkjøring og andre faktorer.  Dette er bare toppen av isfjellet. På riksveiene er det 78 steder med høy skredfaktor, og på fylkesveiene er tallet 123. I tillegg kommer en rekke steder med middels eller lav faregrad, der det fortsatt er behov for tiltak, sier PERSON. På mange utsatte strekninger er det behov for tunnel eller ny trasé for å sikre veien. I tillegg til de store investeringene som trengs på noen av de mest rasfarlige strekningene, er det mye som kan gjøres med mindre tiltak. Varsling, sikring av terrenget og andre utbedringer kan gjennomføres relativt raskt, om midlene kommer på plass, sier PERSON. Riksveier rangert etter skredfaktor: Rv 13 Kvassdalen Vestland, Rv13 Osgjelet Vestland, Rv 5 Skredvikja Vestland, E16 Vaksdal Vestland, Rv 13 Byrkjenes Vestland, Rv 15 Grasdalen Vestland, E 10 Presteneset Nordland, E10 Kvanndalen Nordland, Rv 13 Øvre Lonevatn Vestland, Rv 13 Ygningsdalshamrane Vestland, Fylkesveier rangert etter skredfaktor: Fv 5744 Navelsakerstranda Vestland, Fv 5829 Otterdalsstranda Møre og Romsdal, Fv 613 Gaularfjellet Vestland, Fv 5723 Merkingsgjølet Vestland, Fv 7594 Myrlandsfjellet Nordland, Fv 5625 Skjerdalsberget Vestland, Fv 8830 Store Lerresfjord Finnmark, Fv 5724 Heimefonna Vestland, Fv 49 Snauhaugtunnelen Vestland, Fv 49 Tokagjeltunnelen Vestland"},
                {"role": "assistant", "content": "{'locations': [{'name': 'Norge', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vestland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordsland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Troms', 'type': 'Location', 'entity': 'Land'}, {'name': 'MøreOgRomsdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Kvassdalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Osgjelet', 'type': 'Location', 'entity': 'Land'}, {'name': 'Skredvikja', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vaksdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Byrkjenes', 'type': 'Location', 'entity': 'Land'}, {'name': 'Grasdalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Presteneset', 'type': 'Location', 'entity': 'Land'}, {'name': 'Kvanndalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'ØvreLonevatn', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Ygningsdalshamrane', 'type': 'Location', 'entity': 'Land'}, {'name': 'Navelsakerstranda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Otterdalsstranda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Gaularfjellet', 'type': 'Location', 'entity': 'Mountain'}, {'name': 'Merkingsgjølet', 'type': 'Location', 'entity': 'Land'}, {'name': 'Myrlandsfjellet', 'type': 'Location', 'entity': 'Mountain'}, {'name': 'Skjerdalsberget', 'type': 'Location', 'entity': 'Land'}, {'name': 'StoreLerresfjord', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Heimefonna', 'type': 'Location', 'entity': 'Land'}, {'name': 'Snauhaugtunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Tokagjeltunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Finnmark', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Norge', 'relation': 'contains', 'target': 'Vestland'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Nordsland'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Troms'}, {'from': 'Norge', 'relation': 'contains', 'target': 'MøreOgRomsdal'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Kvassdalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Osgjelet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Skredvikja'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Vaksdal'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Byrkjenes'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Grasdalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Presteneset'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Kvanndalen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'ØvreLonevatn'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Ygningsdalshamrane'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Navelsakerstranda'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Otterdalsstranda'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Gaularfjellet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Merkingsgjølet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Myrlandsfjellet'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Skjerdalsberget'}, {'from': 'Norge', 'relation': 'contains', 'target': 'StoreLerresfjord'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Heimefonna'}, {'from': 'Snauhaugtunnelen', 'relation': 'isPassingThrough', 'target': 'Norge'}, {'from': 'Tokagjeltunnelen', 'relation': 'isPassingThrough', 'target': 'Norge'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Finnmark'}]}"},
                {"role": "user", "content": "En personbil kolliderte med stor kraft med en tankbil i en tunnel mellom Voss og Bergen. Tankbilen fraktet etsende væske.  I tunnelen bak oss har det skjedd en alvorlig ulykke mellom en trailer og en personbil. Det er en møteulykke og det er store skader på både personbil og trailer, sier innsatsleder PERSON i Vest politidistrikt. Ulykken skjedde litt etter klokken 18, i Stavenestunnelen på E16 i Vaksdal i Vestland. Det var kun én person i hvert kjøretøy. Lastebilen var på vei til Bergen og personbilen på vei mot Voss. Det er én person som er omkommet. Lastebilsjåføren har vi fått ut av tunnelen. Han er lettere skadet og brakt til Bergen til legeundersøkelse. Avdødes pårørende er varslet, opplyser PERSON. Tankbilen lekker etsende væske. Det gjør nødetatenes redningsarbeid vanskeligere.Det er en vanskelig og uavklart situasjon der inne, med denne væsken og at det teoretisk kan begynne å brenne. Vi har etablert brannberedskap der inne, i tilfelle det skulle skje noe med disse to kjøretøyene, sier PERSON. Politiet har fått vite at det er snakk om et rensestoff som brukes i vann. Det er ikke en eksplosjonsfarlig væske. Det er i utgangspunktet ikke farlig, sier Listøl, som forklarer at den kun er skadelig hvis man får den på huden, inntar den eller hvis den begynner å brenne. Stengt i lang tid. Arbeidet på åstedet kompliseres også av at tankbilen som lekker, står kilt fast inne i tunnelen. Vi planlegger nå hvordan vi skal få stoppet lekkasjen, hvordan vi skal komme oss inn i tunnelen for å gjennomføre åstedsundersøkelser med Statens ulykkesgruppe og politiets kriminalteknikere. Tunnelen er ellers helt tømt. E16 er stengt og vil være stengt i lang tid fremover. Iallfall gjennom natten og langt utpå tirsdagen, sier PERSON. Det har vært en konstant lekkasje ut i veibanen. Denne tanken på vogntoget ligger veltet inn mot fjellveggen, i klem. Nå får vi høre at lekkasjen har avtatt noe. Krimteknikere på vei. Like før klokken 20 opplyste politiet at ulykkesgruppen samt politiets kriminalteknikere var på vei til stedet. Nødetatene planlegger nå for å få stengt lekkasjen, av det som blir betegnet som en svakt etsende væske som er ufarlig, opplyser politiet. Vegtrafikksentralen vest opplyser at omkjøring er via Hardanger Fylkesvei 49 og Fylkesvei 79."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Voss', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vaksdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vestland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Hardanger', 'type': 'Location', 'entity': 'Land'}], 'relationships': []}"},
                {"role": "user", "content": "Flere store ras har gått i Vestland mandag. E16 er stengt i Nærøydalen, mens på Voss er flere hytter truffet av ras. Flere hytter er truffet av jord og steinmasser ved Voss Resort på Tråstølen. En video TV 2 har fått tilsendt, viser hvordan massene har tatt seg ned gjennom hyttefeltet og hvordan det går tett inntil flere hytter. Til TV 2 sier operasjonsleder PERSON i politiet at de har gjort seg ferdige på stedet og at det ikke er meldt om noen skader på personer eller bygninger. Det er mye vann i området og har trukket med seg jord og stein. Veien oppe i hytteområdet er ødelagt enkelte steder. Videre sier han at de har vært i dialog med Voss Resort, som har gravd nye grøfter for å lede vannet andre steder. Politet har også vært i kontakt med beredskapsavdelingen i kommunen. Det er foretatt noen vurderinger, men ingen er bedt om å forlate hyttene. Flere ras over E16. På E16s strekning mellom Voss og Lærdal er veien er stengt flere steder som følge av steinras og styrtregn. Blant annet holdes Gudvangatunnelen i Aurland og Sivletunnelen i Voss stengt inntil videre på grunn av rasene. Til TV 2 bekrefter brannvesenet i Vest at to hus er evakuert i Nærøydalen. Her har også brannvesenet hatt en drone i lufta, men ikke oppdaget at noe eller noen er tatt av raset. Operasjonsleder PERSON sier til TV 2 at de har patruljer på stedet ved 19.40tiden, og at de har undersøkt raset så godt det lar seg gjøre før opprydningsarbeidet starter. Vi kan ikke helt med sikkerhet si at det befinner seg noe i raset, men vi har ingen indikasjoner på at det skal være tilfellet. Noen arbeidere i området har også ifølge polititet tatt inn på hotell i Gudvangen. Ifølge brannvesenet er det ved 18tiden ikke mulig å si hvor lenge veien vil være sperret.  Det er et svært ras, og det vil trolig ta lang tid å åpne opp igjen, sier vaktkommandør i brannvesenet til TV 2. Stengt flere steder. ølge brannvesenet er raset rundt tre meter høyt på det høyeste. Mens til VG sier politiet at raset skal være fem meter høyt på det høyeste. Det var ved 16.40tiden at brannvesenet meldte om at de hatt fått meldinger om flere ras over veien her. Det er stort ras som sperrer hele veien. Det er alt vi vet, men nødetatene er på vei. Gudvangatunnelen og Sivletunnelen holdes stengt til vi får oversikt, sa trafikkoperatør PERSON i Statens vegvesen da til Bergensavisen. Ifølge NRK er også Stalheimtunnelen i Voss stengt etter steinraset i Nærøydalen. Farevarsel. Flere steder på Vestlandet er mandag rammet av store nedbørsmengder. Det er sendt ut gult farevarsel (nivå to av fire) for store deler av landsdelen. Fra Nordfjord i Stad i nord til Mandal i sør er det gult farevarsel for styrtregn, ifølge Varsom. Verst vil det trolig være fra Sauda i sør til litt nord for Bergen. Nettstedet skriver at det er fare for overvann i tettbygde områder, lokale oversvømmelser, bekke og elveløpsendringer, jord og flomskred der regnbygene treffer. De advarer også om at det er fare for stengte veier og/eller overvann ved bekke og elveløp samt lokalt vanskelige kjøreforhold grunnet overvann og fare for vannplaning. Turister skal være innesperret. Politiet sier at de har hatt flere hendelser knyttet til været mandag. Men det har roet seg nå de siste par timene, sier operasjonsleder PERSON ved 19.40tiden. Det siste er at det har gått nok et ras nede ved fergekaien i Gudvangen, men ingen skader der heller. Det er mulig at noen turister er innesperret der. Det er rekvirert en båt for å få dem ut på rett side av raset, sier operasjonslederen. Bil truffet av stein. Avisa Hordaland melder at en bil på fylkesvei 79 i Granvin i Voss ble truffet av steinsprang. En kvinne som var passasjer i bilen, ble truffet av steinen etter at den gikk gjennom frontruten, opplyser politiet. Kvinnen, som var en fransk turist, er sendt til sykehus på Voss, ifølge avisen. Skadeomfanget er ukjent, men kvinnen skal ha være bevisst da hun ble ivaretatt av helsepersonell på stedet."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Nærøydalen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Voss', 'type': 'Location', 'entity': 'Land'}, {'name': 'Tråstølen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Aurland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Gudvangen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sivletunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Stalheimtunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Nordfjord', 'type': 'Location', 'entity': 'Ocean'}, {'name': 'Stad', 'type': 'Location', 'entity': 'Land'}, {'name': 'Mandal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sauda', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Granvin', 'type': 'Location', 'entity': 'Land'}, {'name': 'Hordaland', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Voss', 'relation': 'contains', 'target': 'Tråstølen'}, {'from': 'Voss', 'relation': 'isNearby', 'target': 'Lærdalen'}, {'from': 'Gudvangtunnelen', 'relation': 'isPassingThrough', 'target': 'Aurland'}, {'from': 'Sivletunnelen', 'relation': 'isPassingThrough', 'target': 'Voss'}, {'from': 'Stalheimtunnelen', 'relation': 'isPassingThrough', 'target': 'Voss'}, {'from': 'Voss', 'relation': 'contains', 'target': 'Nærøydalen'}, {'from': 'Stad', 'relation': 'contains', 'target': 'Nordfjord'}, {'from': 'Sauda', 'relation': 'isNearby', 'target': 'Bergen'}]}"},
                {"role": "user", "content": "Det seier politisjef i Sogn og Fjordane, Arne Johannessen. Politiet har no kome med sin uttale til den planlagde oppgraderinga av Lærdalstunnelen, som vil bety full eller delvis stenging. Johannessen og politiet er krystallklare på at dette har følgjer for vaktsystema,  beredskapen og kostnadene ved dette. Full stenging er veldig krevjande for oss, og ut ifrå eit beredskapsmessig perspektiv er dette eit svært dårleg alternativ. Me har også problematisert det andre alternativet med delvis stenging, og meiner det må inn kompenserande tiltak, seier PERSON."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Lærdalstunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Lærdal', 'type': 'Location', 'entity': 'Land'}, {'name': 'SognOgFjordane', 'type': 'Location', 'entity': 'Road'}], 'relationships': [{'from': 'Lærdalstunnelen', 'relation': 'isPassingThrough', 'target': 'SognOgFjordane'}]}"},
                {"role": "user", "content": "Davidsen ble gjenvalgt med stående applaus på Pensjonistforbundets landsmøte onsdag. Jeg takker for tilliten og er ydmyk, sa han. Dermed går PERSON løs på sin tredje periode som forbundsleder i landets desidert største organisasjon for alderspensjonister og uføre. I tillegg til PERSON består Pensjonistforbundets nye sentralstyre frem til 2026 av; 1. nestleder: PERSON (Sogn og Fjordane) 2. nestleder: PERSON (Agder) Styremedlem: PERSON (Akershus) Styremedlem: PERSON (Troms) Styremedlem: PERSON (Oppland) Styremedlem: PERSON (Trøndelag) 1. varamedlem: PERSON, Oslo 2. varamedlem: PERSON, PERSON 3. varamedlem: PERSON, Nordland 4. varamedlem: PERSON, Vestfold I tillegg har Fagforbundet to medlemmer i sentralstyret PERSON og PERSON."},
                {"role": "assistant", "content": "{'locations': [{'name': 'SognOgFjordane', 'type': 'Location', 'entity': 'Land'}, {'name': 'Agder', 'type': 'Location', 'entity': 'Land'}, {'name': 'Akershus', 'type': 'Location', 'entity': 'Land'}, {'name': 'Troms', 'type': 'Location', 'entity': 'Land'}, {'name': 'Oppland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Trøndelag', 'type': 'Location', 'entity': 'Land'}, {'name': 'Oslo', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vesthold', 'type': 'Location', 'entity': 'Land'}], 'relationships': []}"},
                {"role": "user", "content": "No trur eg kanskje me endar med å køyra endå lenger. Det er vegarbeid, seier en person på bussen heim frå Os. Heldigvis med siger og cupavansement i bagasjen. Det er sikkert. Me fekk veldig mange borteturar på kort tid no, men eg trur ikkje dette påverkar oss så veldig. Me er godt vande med å køyra buss. Me kunne ikkje brukt det som ei bortforklaring. Alle har to seter kvar og me får sett mykje film, seier en annen person. Det hadde vorte hylekor Det er en tredje person som har rekna ut avstanden Sogndal har køyrt i buss til og frå dei siste fire kampane. Eg skulle likt å høyra eitt av austlandslaga om dei hadde måtta leggja ut på ein tilsvarande distanse på 12 dagar. Det hadde vorte eit hylekor, seier vedkommende og ristar på hovudet. Sogndal starta med følgjande lag i Os: Sætren – Hoven, Arrocha, Gueye, Sjølstad – Steinset, Twum, Nessø – Kupen, Diaz, Ørjasæter. 120 lange minuttar Og det reisetrøytte Sogndallaget sitt siste stopp mot 3. divisjonslaget Lysekloster, i Os på andre sida av Bergen, vart av det slitsame slaget. Det sat langt inne å sikra seg avansement til 3. runde i cupen. Kristoffer Nessø sende Sogndal i føringa allereie etter to minutt, men då Lysekloster utlikna tre minutt seinare var dei like langt. Og dei kom ikkje lenger før det var spelt 110 minutt med fotball i finvêret på Os. Først ut i andre ekstraomgang greidde innbytar Jonatan Jonsson å avgjera, med ein meisterleg enkeltmannsprestasjon. Han sprang frå midten av motstandarane sin halvdel, og fyrte av ein kanon i nettet. Det var ikkje plankekøyring etter det heller. Isaac Twum fekk sitt andre gule nett etter, og fekk avslutta kampen litt før dei andre. Men Sogndal rodde det i land. Ikkje lyst Eg hadde ikkje lyst på ekstraomgangar. Men det måtte me ha. Så det vart ein lang kamp. Men det gjer det lettare når me vinn til slutt. Vedkommende vedgår at sigeren sat veldig langt inne. Det var tøft til siste sekund. Lysekloster gav oss skikkeleg kamp. Me fekk ingenting gratis. Dei var kjappe til å koma seg bak, så me fekk aldri tatt dei på kontringar og slikt som du ofte klarar mot lag som ligg lågare. Så snart dei mista ballen var dei utruleg kjapt organisert, seier en person. Mange rauk ut i kveld Medan Sogndal klarte det, rauk divisjonskollegaene Hødd, Skeid, Kongsvinger og Bryne ut – alle mot det ein må rekna som svakare motstand. Og på toppen av det heile gjekk eliteserielaga Rosenborg, Lillestrøm og Stabæk på kvar si cupbombe mot StjørdalsBlink og Kjelsås. – Alle veit at slike cupkampar er ikkje berre enkelt. Når Lillestrøm og Rosenborg ryk ut i andre runde viser det at det kan bli vanskeleg når motstandarlaget fekk momentum. Me såg det på Lysekloster og. Dei jubla for kvar takling. Det er inga orsaking om me taper, men me vann til slutt. Sonen skåra Vel inne i bussen fekk han også gladmeldinga om at sonen Johan skåra sitt eine mål i tapet mot Brann i same turnering. – Eg trur eg har skåra ein gong sjølv. Det var bra. Det hadde vorte mobbing elles, seier en person som ikkje har hastverk med å avslutta telefonsamtalen. – Takk for praten. Me skal sitja her i mange timar."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Agder', 'type': 'Location', 'entity': 'Land'}, {'name': 'Sogndal', 'type': 'Location', 'entity': 'Land'}, {'name': 'Rosenborg', 'type': 'Location', 'entity': 'Land'}, {'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Lillestrøm', 'type': 'Location', 'entity': 'Land'}, {'name': 'Stabæk', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Norge', 'relation': 'contains', 'target': 'Bergen'}, {'from': 'Norge', 'relation': 'contains', 'target': 'Os'}]}"},
                {"role": "user", "content": "Stadig flere turister fra hele verden tar turen til bergensregionen etter å ha lest om norsk ull og strikkekunst. Smakfulle bilder i sosiale medier er et viktig trekkplaster. Denne helgen samles flere hundre strikkeentusiaster på Osterøy til fire dagers samling. – Strikketurismen i vår region er økende. Vi ser at stadig flere utlendinger besøker regionen vår for å lære om ull og strikk, bekrefter reiselivsdirektør Anders Nyland i Visit Bergen. Den franske strikkedesigneren Julie Dubreaux, som kommer til Osterøy, har 43.100 følgere på Instagram:Britiske strikketurister I september kommer en britisk delegasjon med egen guide på besøk til Nordhordland for andre året på rad. De skal på strikkeferie i åtte dager, bekrefter han. – Det gleder oss å se at markedsføringen av Wool Heritage Route, som vi har gjort sammen med gode partnere, begynner å bære frukter. Treffer man godt i en slik nisje ser vi at dette er gjester med god betalingsevne som blir her i mange dager, sier Nyland.Reiselivsdirektøren er selv en av foredragsholderne under strikketreffet. Han trekker frem lokale produsenter som Norlender, Oleana og Dale of Norway som viktige trekkplastre. Et ullent eventyr Fredag starter det rikholdige strikkeprogrammet i Mjøsvågen på Osterøy. Initiativtakeren heter Anne Bjørke. Hun har invitert en rekke norske og utenlandske designere, deriblant Julie Dubreaux fra Paris og estiske Aleks Byrd til et felles «ulleventyr». – Fredag arrangerer vi bransjeseminar med fokus på norsk ull og ullturisme, som kan gi bønder og småskalabedrifter et ekstra bein å stå på. Vi samarbeider med Norlender i Lonevåg, en av få gjenlevende trikotasjebedrifter som fortsatt produserer strikkeplagg i Norge, forteller hun. Lørdag og søndag blir det avholdt kurs med strikkekjendiser, catwalk på flytebryggen og foredrag. Blant annet skal den ukrainske designeren Iaroslava Rud fortelle om sine blondesjal inspirert fra strikkekunsten på Shetland. – Her håper vi på mange besøkende og har fortsatt ledige billetter! Tilbyr gratis overnatting Anne Bjørke står bak bokprosjektet Strikkekraft, der designdesignerne skal bruke Norlenders maskinstrikkede plagg som en felles inspirasjonskilde og lage 20 nye håndstrikkmønstre. Deltakerne på Osterøysamlingen får smakebiter på norsk tradisjonsstrikk og internasjonal design fra Nigeria og Shetland til Ukraina, Estland og Frankrike. – Målet er å treffe likesinnede og hente inspirasjon. Jeg elsker å reise til andre land og se hva andre lager. Estisk og norsk strikkekunst har mange ulikheter, men også likheter, sier Aleks Byrd til BA. – Folk i bygden stiller opp med sengeplasser til alle designerne, maten blir laget på dugnad og det blir dropin i den flytende kunstbadstuen Flabellina. Den ideelle stiftelsen Vener av Mjøsvågen er en aktiv støttespiller, skryter Anne Bjørke."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Osteræy', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nordhordaland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Norway', 'type': 'Location', 'entity': 'Land'}, {'name': 'Paris', 'type': 'Location', 'entity': 'Land'}, {'name': 'Nigeria', 'type': 'Location', 'entity': 'Land'}, {'name': 'Shetland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Ukraina', 'type': 'Location', 'entity': 'Land'}, {'name': 'Estland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Frankrike', 'type': 'Location', 'entity': 'Land'}], 'relationships': [{'from': 'Frankrike', 'relation': 'contains', 'target': 'Paris'}]}"},
                {"role": "user", "content": "Vegtrafikksentralen rapporterte om et trafikkuhell ved Vetlebotnvatnet på Fv. 50 i Aurland fredag kl. 12:34. Nødetatene rykket ut til stedet. Politiet kunngjorde på Twitter at en motorsykkel hadde kjørt av veien ved Stemmedalen, og føreren var ved bevissthet. Kl. 13:15 meldte Vegtrafikksentralen at veien ville bli stengt mens luftambulansen landet på stedet. Rundt halv to opplyste politiet at føreren ville bli fløyet til sykehuset i Førde. 'Føreren er ved bevissthet. Han kan ha pådratt seg mindre skader. Trafikkregulering på stedet, og en bilbergingsenhet er tilkalt,' skrev politiet i meldingen."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Aurland', 'type': 'Location', 'entity': 'Land'}, {'name': 'Førde', 'type': 'Location', 'entity': 'Land'}, {'name': 'Vetlebotnvatnet', 'type': 'Location', 'entity': 'Ocean'}], 'relationships': [{'from': 'Aurland', 'relation': 'contains', 'target': 'Vetlebotnvatnet'}]}"},
                {"role": "user", "content": "Det ble travelt for utrykningspolitiet da de torsdag ettermiddag hadde laserkontroll ved utløpet av Knappetunnelen i Dolvik. Mellom klokken 14 og 17 stoppet UP 28 bilister som kjørte over fartsgrensen i 80sonen. UP fikk mange reaksjoner på høyt fartsnivå. De kunne ha stoppet enda flere bilister, men hadde ikke kapasitet eller mannskap til å stoppe alle, opplyser stasjonssjef Ronny André Øvrebotten ved Bergen sør politistasjon. Det var en mcfører som ble målt til høyest fart torsdag ettermiddag. Mcføreren, en mann i 20årene, kjørte i 152 km/t i 80sonen. Han kjørte så fort at han mistet førerkortet, sier Øvrebotten."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Bergen', 'type': 'Location', 'entity': 'Land'}, {'name': 'Knappetunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Dolvik', 'type': 'Location', 'entity': 'Land'}], 'relationship': [{'from': 'Knappetunnelen', 'relation': 'isPassingThrough', 'target': 'Dolvik'}]}"},
                {"role": "user", "content": "Rv 5 Kjøsnestunnelen i Sunnfjord er midlertidig stengt på grunn av en stor gjenstand på veien, som antas å ha falt fra en lastebil. Politiet er på vei, som rapportert av Vegtrafikksentralen på Twitter. Det ble også rapportert at Fjærlandstunnelen var stengt på grunn av bilberging. Klokken 14.44 ble det rapportert at bilberging var fullført, og denne tunnelen ble åpnet igjen. Klokken 14.55 ble også Kjøsnestunnelen åpnet igjen."},
                {"role": "assistant", "content": "{'locations': [{'name': 'Kjøsnestunnelen', 'type': 'Location', 'entity': 'Road'}, {'name': 'Sunnfjord', 'type': 'Location', 'entity': 'Land'}, {'name': 'Fjærlandstunnelen', 'type': 'Location', 'entity': 'Road'}], 'relationships': [{'from': 'Kjøsnestunnelen', 'relation': 'isPassingThrough', 'target': 'Sunnfjord'}]}"},
                {"role": "user", "content": f"Now, given the following text, please extract the locations and their geographical relationships and return the output in a valid JSON String output format, and do it to anything that remotely resemble a geo location: Text: {prompt}"}
            ],
            temperature = 0.5,
            max_tokens = Config.MAX_TOKENS
        )

        # Extract the API response
        api_response = response.choices[0].message.content
        return api_response
